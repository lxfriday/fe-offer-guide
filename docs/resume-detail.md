# 简历项目介绍

## 云存储管理
### 上传文件，支持进度查看，取消任务

- 选择单文件上传
- 选择文件夹上传
  - `e.target.files`
- 截图上传
- 粘贴文件上传
- 粘贴文件夹上传
  - `e.clipboardData.items`
- 拖拽上传
  - `dragenter`
  - `dragover`
  - `dragleave`
  - `dragdrop`
    - `e.dataTransfer.files`
- ? 相关面试问题
  - 大文件上传如何处理

---

- 难点：需要支持的上传模式比较多，需要先知道要上传哪个文件，然后进行上传，监控上传进度
- 解法：
  - 把获取文件的逻辑和上传逻辑分离
  - 获取文件分为两类：
    - 选择上传：选择文件、文件夹上传
    - 粘贴、拖拽上传
  - 要上传的文件确定之后，走上传逻辑

---

---
- 难点：如何维持多文件上传的进度
- 解法：
  - 文件上传触发 `onuploadprogress` 的时候，把文件的id、进度传递给uploadmanager上传进度组件
  - 进度组件通过发布订阅模式，通知有新的上传信息，然后比对已有的任务，看是不是新的文件，如果是已经存在的，则更改它的进度
  - 在全局保存一个上传进度队列，再把队列更新到React state 中

- 高级难点
  - 在这里发现React 的setState的性能问题
  - 上传进度回调是一个触发非常频繁的函数，如果是传统的用 this.state 来 SetState，会导致很严重的性能问题，react内部会有非常高频的调度，同时 state 也有可能并不是最新的
  - 解决办法是全局保存上传队列，每次来一个 uploadEvent 事件，则更新全局队列，再用全局队列去 setState，以保持数据的一致性

**在这里发现React的性能短板**

---

---
- 难点：如何支持取消任务，并同步的视图
- 解法：
  - 每次上传的时候都会执行一个 registerCancel 函数，传递的参数包括任务的id和取消这个任务的方法
  - 用户点击取消的时候，执行取消函数，把任务从上传队列信息中剔除出去
---

### 多平台适配：需要适配各个厂商的SDK，提供同一的接口

- 七牛云
- 阿里云
- 腾讯云

---
- 复杂点：
  - 各平台的SDK接口不同
- 解法：
  - 对每个平台写一个类，把各平台的对应接口抽象成有相同输入输出接口的方法
---

### 多层级、文件列表

- 虚拟列表

---

- 难点：应用虚拟列表展示图床
  - 使用虚拟列表的背景：页面需要展示的图片非常多，一次性的展示上千张图片是不现实的，即使使用**懒加载**依然会有性能问题，原因还是同时展示的图片组件过多
- 解法：使用虚拟列表
  - 解决方案：react-window
  - react-window实现原理：
    - 知道需要展示的子节点的数量 count，每个子格子的宽、高
    - 依据容器的宽度，算出每行展示的子节点数量，从而算出有多少行子节点，滚动容器的实际高度应该为多少
    - 滚动容器滑动一定距离之后，计算在当前窗口容器的显示区域内，应该展示的是第a行到第b行的子节点，只渲染这部分子节点，所有的子节点采用绝对定位
    - 提供一个渲染子节点的函数，函数参数会包括是第几个子节点，数据列表
    - 通过数据列表和下标，拿到当前应该展示的数据，进行展示
---

### 本地数据同步问题、搜索实现
  - 本地递归获取bucket内所有文件的元信息，存储在本地
    - 当检测到bucket内的文件发生变更之后，会提醒需要进行本地bucket同步
  - 通过搜索匹配

--- 
- 难点：云服务厂商并没有提供搜索功能
- 解法：
  - 递归获取bucket内的文件元信息，然后存储在本地
  - 调用搜索的时候，读取对应bucket内的文件信息，扫描有没有符合搜索条件的条目
---
### 本地登录逻辑
  - 判断使用sk、sk请求bucket列表是否成功来判断ak、sk是否有效，有效则表示登录成功
  - 存储用户的 ak、sk

### 存在的问题

- 如果bucket内的数据量比较庞大，那么同步的时间消耗比较大
- 文件搜索算法待优化？现在使用的 `indexOf` 进行简单匹配
- 上传下载没有实现并发控制，全部是竞态
- 扩展提供了上传完成之后自动复制的功能，如果选择了文件正在上传，此时又选择文件上传，则会出现后者覆盖前者
- 没有对用户的本地信息进行加密存储，直接采用的明文存储

## mdnice

## Number-precision